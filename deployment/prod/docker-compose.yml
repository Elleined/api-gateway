services:
  prod-api-gateway:
    image: elleined/api-gateway:${IMAGE_TAG}
    container_name: ${CONTAINER_NAME}
    restart: always
    environment:
      - TZ=Asia/Manila
      - PORT=${PORT}
      - LOG_LEVEL=${LOG_LEVEL}
      - DISCOVERY_SERVER_HOST=${DISCOVERY_SERVER_CONTAINER_NAME}
      - DISCOVERY_SERVER_PORT=${DISCOVERY_SERVER_PORT}
    ports:
      - "${PORT}:${PORT}"
    networks:
      - prod-api-gateway-network
    healthcheck:
      test: [ "CMD", "wget", "--spider", "http://${CONTAINER_NAME}:${PORT}/actuator/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

  prod-api-discovery-server:
    image: elleined/api-discovery-server:${DISCOVERY_SERVER_IMAGE_TAG}
    container_name: ${DISCOVERY_SERVER_CONTAINER_NAME}
    restart: always
    environment:
      - TZ=Asia/Manila
      - PORT=${DISCOVERY_SERVER_PORT}
      - LOG_LEVEL=${LOG_LEVEL}
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS}
    ports:
      - "${DISCOVERY_SERVER_PORT}:${DISCOVERY_SERVER_PORT}"
    networks:
      - prod-api-gateway-network
    healthcheck:
      test: [ "CMD", "wget", "--spider", "http://${DISCOVERY_SERVER_CONTAINER_NAME}:${DISCOVERY_SERVER_PORT}/actuator/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

networks:
  prod-api-gateway-network:
    name: ${NETWORK_NAME}
    external: false
    ipam:
      driver: default